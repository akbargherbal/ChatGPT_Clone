# Gemini CLI Master Instructions: AI Chatbot POC

## 1. Core Protocols (The Constitution)

_This section is mandatory boilerplate for every run._

### 1.1. Environment Setup Protocol
- You MUST check for a `.venv` directory. If it does not exist, you MUST create it by running `python -m venv .venv`.
- You MUST use the virtual environment's executables for all `pip` or `python` commands.

### 1.2. Agent Changelog Protocol
- **REMOVED FOR THIS RUN:** This is a "Code Run" as per our Decoupled Mandate Protocol.

## 2. Project Architecture (The Law of the Land)

_This section is mandatory boilerplate for every run._

- **Mandated Technology Stack:** FastAPI, Pytest, Pydantic
- **Architectural Constraints:** HTML snippets for API responses must be generated by functions in `app/templates.py`. These functions must be theme-aware.
- **Context Files for this Task:** You must be aware of the contents of `app/main.py`, `app/templates.py`, and `tests/test_main.py`.

## 3. Current Task (The Executive Order)

_This section is specific to the current session._

- **Context & State Analysis:** The test `test_chat_endpoint_is_theme_aware` is failing. The `create_ai_message` function in `app/templates.py` currently returns a static HTML string and does not accept a model name to change its styling.

- **This Session's Objective:** Implement the necessary logic to make the `test_chat_endpoint_is_theme_aware[pro-...]` test pass by making the template function theme-aware.

- **Task Directive:**
  1.  Modify the function signature of `create_ai_message` in `app/templates.py` to accept two string arguments: `message_text` and `model_name`.
  2.  Inside `create_ai_message`, implement logic to select the correct CSS classes based on the `model_name`.
      -   Define a base set of classes that apply to all models: `ml-4 p-4 rounded-lg max-w-lg prose prose-sm dark:prose-invert transition-all`.
      -   If `model_name` is 'pro', append the theme-specific classes: `bg-white dark:bg-gray-800`.
      -   If `model_name` is 'flash', append the theme-specific classes: `bg-white dark:bg-gray-800 border-l-4 border-cyan-400 shadow-lg`.
      -   Construct the final `div` with the combined classes.
  3.  In `app/main.py`, update the call to `create_ai_message` within the `/chat` endpoint. It should now pass both the placeholder message and the `selectedModel` from the `chat_request`.

- **Verification Protocol (Definition of Done):**
  - The task is successfully completed when running `pytest` results in **4 passed** tests.