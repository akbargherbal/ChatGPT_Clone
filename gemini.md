# Gemini CLI Master Instructions: AI Chatbot POC

## 1. Core Protocols (The Constitution)

_This section is mandatory boilerplate for every run._

### 1.1. Environment Setup Protocol
- You MUST check for a `.venv` directory. If it does not exist, you MUST create it by running `python -m venv .venv`.
- You MUST use the virtual environment's executables for all `pip` or `python` commands.

### 1.2. Agent Changelog Protocol
- **REMOVED FOR THIS RUN:** This is a "Code Run" as per our Decoupled Mandate Protocol.

## 2. Project Architecture (The Law of the Land)

_This section is mandatory boilerplate for every run._

- **Mandated Technology Stack:** FastAPI, Pytest, Pydantic
- **Architectural Constraints:** HTML snippets for API responses must be generated by functions in `app/templates.py`. These functions should be theme-aware.
- **Context Files for this Task:** You must be aware of the contents of `tests/test_main.py`, `app/templates.py`, and `static/index.html`.

## 3. Current Task (The Executive Order)

_This section is specific to the current session._

- **Context & State Analysis:** The current `create_ai_message` function in `app/templates.py` generates a static HTML snippet. The `static/index.html` file defines different background classes for AI messages based on the selected model ('pro' vs. 'flash'). Our tests do not currently verify this theming logic.

- **This Session's Objective:** Create a failing test that drives the implementation of theme-aware logic in our server-side template.

- **Task Directive:**
  1.  Open the file `tests/test_main.py`.
  2.  At the top of the file, add the import: `import pytest`.
  3.  Create a new test function named `test_chat_endpoint_is_theme_aware`.
  4.  Decorate this function with `@pytest.mark.parametrize` to run it for two cases:
      -   A 'pro' model, which should expect the CSS class `bg-white dark:bg-gray-800`.
      -   A 'flash' model, which should expect the CSS class `border-l-4 border-cyan-400`.
  5.  The test function should take two arguments: `model_name` and `expected_class`.
  6.  Inside the test, perform a `POST` request to the `/chat` endpoint, using the `model_name` from the parameters in the JSON payload.
  7.  Assert that the `response.text` contains the `expected_class` string from the parameters.

- **Verification Protocol (Definition of Done):**
  - The task is successfully completed when running `pytest` results in **1 failed** and **3 passed** tests. The single failure should be the new `test_chat_endpoint_is_theme_aware`.